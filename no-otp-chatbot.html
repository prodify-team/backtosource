<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Back to Source - Training Bot v2.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Devanagari', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            width: 100%;
            max-width: 400px;
            min-height: 600px;
        }

        .login-container {
            padding: 40px 30px;
            text-align: center;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .message.user {
            background: #667eea;
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }

        .message.ai {
            background: #f1f3f4;
            color: #333;
            align-self: flex-start;
        }

        .input-container {
            display: flex;
            gap: 10px;
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            font-family: 'Noto Sans Devanagari', Arial, sans-serif;
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }

        .send-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 18px;
        }

        .hidden {
            display: none;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 20px;
        }

        p {
            color: #666;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Container -->
        <div id="loginContainer" class="login-container">
            <h1>‡§¨‡•à‡§ï ‡§ü‡•Ç ‡§∏‡•ã‡§∞‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h1>
            <p>350+ Team Members | Multiple Locations</p>
            
            <div id="phoneForm">
                <input type="tel" id="phoneNumber" class="form-input" placeholder="‡§Ö‡§™‡§®‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç (+91)" maxlength="13">
                <button class="login-btn" onclick="startLogin()">Login ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
            
            <div id="profileForm" class="hidden">
                <h2>Profile Setup</h2>
                <input type="text" id="userName" class="form-input" placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
                <select id="userRole" class="form-select">
                    <option value="">‡§Ö‡§™‡§®‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</option>
                    <option value="owner">Owner</option>
                    <option value="manager">Manager</option>
                    <option value="chef">Chef</option>
                    <option value="waiter">Waiter</option>
                    <option value="delivery-boy">Delivery Boy</option>
                    <option value="supervisor">Supervisor</option>
                    <option value="trainee">Trainee</option>
                </select>
                <select id="location" class="form-select">
                    <option value="">Restaurant Location ‡§ö‡•Å‡§®‡•á‡§Ç</option>
                    <option value="delhi-cp">Delhi - Connaught Place</option>
                    <option value="mumbai-bandra">Mumbai - Bandra</option>
                    <option value="bangalore-koramangala">Bangalore - Koramangala</option>
                    <option value="pune-fc-road">Pune - FC Road</option>
                </select>
                <button class="login-btn" onclick="completeSetup()">Start Chatting</button>
            </div>
        </div>

        <!-- Chat Container -->
        <div id="chatContainer" class="chat-container hidden">
            <div class="chat-header">
                <h3 id="userInfo">Back to Source Training Bot</h3>
                <p>‡§Ü‡§™‡§ï‡§æ AI Training & Task Assistant</p>
            </div>
            
            <div class="messages" id="messages"></div>
            
            <div class="input-container">
                <input type="text" id="messageInput" class="message-input" placeholder="‡§Ö‡§™‡§®‡§æ message ‡§≤‡§ø‡§ñ‡•á‡§Ç..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let tempPhone = '';

        function startLogin() {
            const phone = document.getElementById('phoneNumber').value.trim();
            
            if (!phone || phone.length < 10) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä phone number ‡§°‡§æ‡§≤‡•á‡§Ç');
                return;
            }
            
            tempPhone = phone;
            
            // Show profile form directly (no OTP)
            document.getElementById('phoneForm').classList.add('hidden');
            document.getElementById('profileForm').classList.remove('hidden');
        }

        function completeSetup() {
            const name = document.getElementById('userName').value.trim();
            const role = document.getElementById('userRole').value;
            const location = document.getElementById('location').value;
            
            if (!name || !role || !location) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä fields ‡§≠‡§∞‡•á‡§Ç');
                return;
            }
            
            currentUser = {
                phone: tempPhone,
                name: name,
                role: role,
                location: location
            };
            
            startChat();
        }

        function startChat() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('chatContainer').classList.remove('hidden');
            
            document.getElementById('userInfo').textContent = `${currentUser.name} (${currentUser.role})`;
            
            // Welcome message
            const welcomeMsg = `Namaste ${currentUser.name} Ji! üôè

Main aapka Training & Task Bot hun. Kaise help kar sakta hun?

üìö Training Commands:
‚Ä¢ "dal makhani recipe" - Recipe seekhiye
‚Ä¢ "hygiene rules" - Safety guidelines
‚Ä¢ "training chahiye" - Role-based training

üìã Task Commands:  
‚Ä¢ "task add karo" - Naya task
‚Ä¢ "mera task dikhao" - Current tasks

Kya janna chahte hain?`;
            
            addMessage(welcomeMsg, 'ai');
        }

        function addMessage(text, type) {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            addMessage('Typing...', 'ai');
            
            // Remove typing indicator first
            const messages = document.getElementById('messages');
            if (messages.lastChild && messages.lastChild.textContent === 'Typing...') {
                messages.removeChild(messages.lastChild);
            }

            // Try API first, but always fall back to local responses
            let apiWorked = false;
            
            try {
                const apiUrl = window.location.hostname === 'localhost' ? 'http://localhost:3000/api/chat-simple' : '/api/chat-simple';
                console.log('Trying API:', apiUrl);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        userRole: currentUser.role,
                        userName: currentUser.name,
                        preferredLanguage: 'hinglish'
                    })
                });
                
                console.log('API Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('API Success:', data);
                    addMessage(data.response, 'ai');
                    apiWorked = true;
                } else {
                    console.log('API Error:', response.status, response.statusText);
                }
                
            } catch (error) {
                console.error('API Failed:', error.message);
            }
            
            // If API didn't work, use local responses
            if (!apiWorked) {
                console.log('Using local fallback response');
                const fallbackResponse = getEnhancedFallbackResponse(message, currentUser.role, currentUser.name);
                addMessage(fallbackResponse, 'ai');
            }
        }

        function getEnhancedFallbackResponse(message, userRole, userName) {
            const lowerMsg = message.toLowerCase();
            
            // Role-specific responses
            if (lowerMsg.includes('dal makhani') || lowerMsg.includes('‡§¶‡§æ‡§≤ ‡§Æ‡§ñ‡§®‡•Ä')) {
                if (userRole === 'chef') {
                    return `Namaste Chef ${userName}! üë®‚Äçüç≥\n\nüçõ **Dal Makhani - Chef Level Recipe**\n\n‚Ä¢ **Ingredients:** ‡§ï‡§æ‡§≤‡•Ä ‡§¶‡§æ‡§≤ 1 cup, ‡§∞‡§æ‡§ú‡§Æ‡§æ 1/4 cup, ‡§Æ‡§ï‡•ç‡§ñ‡§® 4 tbsp, ‡§ï‡•ç‡§∞‡•Ä‡§Æ 1/2 cup\n\n‚Ä¢ **Chef Method:**\n  - 8 hours soaking zaroori hai\n  - Pressure cook 4-5 whistles with salt\n  - Slow cook 4-6 hours on low flame\n  - Tempering: cumin, onions, tomatoes\n  - Final touch: cream ‡§î‡§∞ butter\n\n‚Ä¢ **Wrong Way:** Fast cooking ‡§Ø‡§æ microwave mein banana\n‚Ä¢ **Right Way:** Traditional slow cooking with patience\n\n‚Ä¢ **Chef Assignment:** Practice temperature control aur timing perfect kariye\n\n‚Ä¢ **Daily Tip:** Authentic taste ke liye dhimi aanch pe sabr rakhiye! üî•`;
                } else if (userRole === 'waiter') {
                    return `Namaste ${userName}! üçΩÔ∏è\n\nüçõ **Dal Makhani - Service Knowledge**\n\n‚Ä¢ **Description:** "Our signature slow-cooked black lentils with butter and cream"\n‚Ä¢ **Cooking Time:** 6+ hours slow cooking process\n‚Ä¢ **Serving Style:** Hot, garnished with cream swirl\n‚Ä¢ **Pairing:** Butter Naan, Jeera Rice, Tandoori Roti\n‚Ä¢ **Allergens:** Contains dairy (butter, cream)\n\n‚Ä¢ **Wrong Way:** "It's just dal" kehna guests ko\n‚Ä¢ **Right Way:** Passionate description with cooking details\n\n‚Ä¢ **Assignment:** 5 guests ko dal makhani ki story batayiye\n\n‚Ä¢ **Daily Tip:** Food ki story batane se guests impressed hote hain! ‚ú®`;
                } else {
                    return `Namaste ${userName}! üìö\n\nüçõ **Dal Makhani - Learning Basics**\n\n‚Ä¢ **What is it:** Our signature dish - black lentils cooked very slowly\n‚Ä¢ **Key Points:**\n  - Takes 6+ hours to cook properly\n  - Made with black lentils and kidney beans\n  - Very creamy and rich taste\n  - Served hot with bread or rice\n\n‚Ä¢ **Why Special:** Long cooking time makes it very special and tasty\n\n‚Ä¢ **Assignment:** 3 experienced staff se dal makhani ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§î‡§∞ details ‡§∏‡•Ä‡§ñ‡§ø‡§è\n\n‚Ä¢ **Daily Tip:** ‡§π‡§∞ ‡§¶‡§ø‡§® ‡§ï‡•Å‡§õ ‡§®‡§Ø‡§æ ‡§∏‡•Ä‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡§ø‡§è! üìñ`;
                }
            }
            
            // Fallback to basic response
            return getFallbackResponse(message);
        }

        function getFallbackResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            // Dal Makhani Recipe
            if (lowerMsg.includes('dal makhani') || lowerMsg.includes('‡§¶‡§æ‡§≤ ‡§Æ‡§ñ‡§®‡•Ä')) {
                return `üçõ **Dal Makhani Recipe - Back to Source Special**

‚Ä¢ **Ingredients:** ‡§ï‡§æ‡§≤‡•Ä ‡§¶‡§æ‡§≤ 1 cup, ‡§∞‡§æ‡§ú‡§Æ‡§æ 1/4 cup, ‡§Æ‡§ï‡•ç‡§ñ‡§® 4 tbsp, ‡§ï‡•ç‡§∞‡•Ä‡§Æ 1/2 cup

‚Ä¢ **Method:**
  - Soak 8 hours
  - Pressure cook 4-5 whistles  
  - Slow cook 4-6 hours
  - Add cream ‡§î‡§∞ butter

‚Ä¢ **Wrong Way:** Fast cooking ‡§™‡§∞ ‡§¨‡§®‡§æ‡§®‡§æ
‚Ä¢ **Right Way:** ‡§ß‡•Ä‡§Æ‡•Ä ‡§Ü‡§Ç‡§ö ‡§™‡§∞ patience ‡§∏‡•á ‡§™‡§ï‡§æ‡§®‡§æ

‚Ä¢ **Assignment:** Practice this recipe aur 2 key points yaad rakhiye

‚Ä¢ **Daily Tip:** Hamesha slow cooking ‡§ï‡§∞‡•á‡§Ç authentic taste ‡§ï‡•á ‡§≤‡§ø‡§è! üî•`;
            }
            
            // Hygiene Rules
            if (lowerMsg.includes('hygiene') || lowerMsg.includes('‡§∏‡§´‡§æ‡§à') || lowerMsg.includes('cleanliness')) {
                return `üßº **Kitchen Hygiene Rules - Daily SOP**

‚Ä¢ **Hand Washing:** 20 seconds soap ‡§∏‡•á ‡§ß‡•ã‡§®‡§æ
‚Ä¢ **Clean Uniform:** ‡§π‡§Æ‡•á‡§∂‡§æ ‡§∏‡§æ‡§´ apron ‡§î‡§∞ hair net
‚Ä¢ **No Jewelry:** Wedding ring ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§ï‡§∞ ‡§ï‡•Å‡§õ ‡§®‡§π‡•Ä‡§Ç
‚Ä¢ **Temperature Check:** Cold 4¬∞C, Hot 65¬∞C+
‚Ä¢ **Food Separation:** Raw ‡§î‡§∞ cooked ‡§Ö‡§≤‡§ó ‡§∞‡§ñ‡•á‡§Ç
‚Ä¢ **FIFO Rule:** First In, First Out follow ‡§ï‡§∞‡•á‡§Ç

‚Ä¢ **Wrong Way:** Dirty hands ‡§∏‡•á food handle ‡§ï‡§∞‡§®‡§æ
‚Ä¢ **Right Way:** ‡§π‡§∞ step ‡§Æ‡•á‡§Ç cleanliness maintain ‡§ï‡§∞‡§®‡§æ

‚Ä¢ **Assignment:** Today 5 times proper handwashing practice ‡§ï‡§∞‡•á‡§Ç

‚Ä¢ **Daily Tip:** Cleanliness is respect - food ‡§ï‡•á ‡§≤‡§ø‡§è, guests ‡§ï‡•á ‡§≤‡§ø‡§è! üôè`;
            }
            
            // Training
            if (lowerMsg.includes('training') || lowerMsg.includes('‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£') || lowerMsg.includes('‡§∏‡§ø‡§ñ‡§æ‡§®‡§æ')) {
                return `üéì **Training Available - Role Based**

‚Ä¢ **Chef Training:** Cooking techniques, recipes, kitchen management
‚Ä¢ **Waiter Training:** Customer service, menu knowledge, order taking  
‚Ä¢ **Delivery Training:** Safety protocols, customer interaction
‚Ä¢ **Supervisor Training:** Team coordination, quality control

‚Ä¢ **Wrong Way:** Bina training ‡§ï‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡§æ
‚Ä¢ **Right Way:** Proper training ‡§≤‡•á‡§ï‡§∞ confident ‡§¨‡§®‡§®‡§æ

‚Ä¢ **Assignment:** Apna role ‡§ï‡•á ‡§≤‡§ø‡§è 1 training module complete ‡§ï‡§∞‡•á‡§Ç

‚Ä¢ **Daily Tip:** Learning never stops - ‡§π‡§∞ ‡§¶‡§ø‡§® ‡§ï‡•Å‡§õ ‡§®‡§Ø‡§æ ‡§∏‡•Ä‡§ñ‡•á‡§Ç! üìö`;
            }
            
            // General Help
            if (lowerMsg.includes('help') || lowerMsg.includes('‡§Æ‡§¶‡§¶')) {
                return `ü§ñ **Main aapki kaise help kar sakta hun?**

‚Ä¢ **Recipes:** "dal makhani recipe" - Cooking guidance
‚Ä¢ **Safety:** "hygiene rules" - Kitchen safety SOPs  
‚Ä¢ **Training:** "training chahiye" - Role-based learning
‚Ä¢ **Tasks:** "task add karo" - Task management

‚Ä¢ **Company Values:**
  - Happiness ‡§î‡§∞ positivity
  - Mutual respect for all
  - Zero discrimination
  - Indian cultural roots

‚Ä¢ **Daily Tip:** Questions puchna is good - learning ‡§ï‡§æ sign hai! üí°

Backend temporarily down hai, but main basic help kar sakta hun Ji!`;
            }
            
            // Default response
            return `Namaste ${currentUser.name} Ji! üôè

Main samjha nahi exactly kya chahiye. Please try:

‚Ä¢ **"dal makhani recipe"** - Cooking guidance
‚Ä¢ **"hygiene rules"** - Safety guidelines  
‚Ä¢ **"training chahiye"** - Learning modules
‚Ä¢ **"help"** - Complete menu

‚Ä¢ **Daily Tip:** Clear questions puchiye, better help mil sakti hai!

(Backend service restart ho rahi hai, thoda wait kariye) üîß`;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
    </script>
</body>
</html>